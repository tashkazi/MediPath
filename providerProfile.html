<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediPath - Provider Profile</title>
    <link rel="stylesheet" href="https://cdn.syncfusion.com/ej2/material.css">
    <script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <style>


        body {
            margin: 0;
            padding: 0;
            position: relative;
        }

        header {
            background-color: #2C3E50;
            color: #ECF0F1;
            padding: 5px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #logo img {
            max-width: 30%;
            height: auto;
            padding-left: 10px;
        }

        #menu-container {
            padding-top: 30px;
            padding-right: 20px;
        }

        #menu-container ul {
            list-style: none;
            display: flex;
            justify-content: flex-end;
            margin: 0;
            padding: 0;
        }

        #menu-container li {
            margin-left: 20px;
        }

        #menu-container a {
            text-decoration: none;
            color: #ECF0F1;
            font-weight: bold;
            font-size: 16px;
        }

        footer {
            background-color: #2C3E50;
            color: #ECF0F1;
            padding: 10px;
            text-align: center;
            width: 100%;
            position: fixed;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }


        .profile-container label {
            margin-bottom: 10px;
            font-weight: bold;
        }

        .profile-container input[type="text"],
        .profile-container input[type="email"],
        .profile-container input[type="tel"],
        .profile-container textarea {
            padding: 8px;
            margin-top: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            width: 100%;
        }

        .profile-container input[type="submit"] {
            background-color: #2f4052;
            color: white;
            margin:  15px;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }


        #updateProfileBtn {
            margin: 10px;
            padding: 10px;
            background-color: #30697c;
            color: white;
        }
        .profile-container input[type="submit"]:hover {
            background-color: #30697c;
        }
        .profile-container {
            position: relative;
            margin: 100px;
            padding: 40px;

            background-color: #f0f0f0;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
        }

        .profile-image-container {
            position: absolute;
            top: 0;
            right: 0;
            margin-left: 20px;
            margin-top: 20px;
        }

        #profileImage {
            max-width: 120px;
            height: auto;
            z-index: 10;
            top: 90px;
            margin-right: 40px;
            border-radius: 10px;
            min-height: 100px;
            margin-bottom: 30px;
        }

    </style>

</head>
<body>

<header>
    <div id="logo">
        <img src="uploads/medi.png" alt="Logo">
    </div>
    <div id="menu-container">
        <ul>
            <li><a href="providerHomepage.html">Home</a></li>
            <li><a href="providerProfile.html">My Profile</a></li>
            <li><a href="providertNotifications.html">Notifications</a></li>
            <li><a href="patients.html">Patients</a></li>
            <li><a href="providerLogin.html">Logout</a></li>
        </ul>
    </div>
</header>

<div class="profile-container">
    <form id="updateProfileForm" enctype="multipart/form-data" method="POST">
        <fieldset>
            <legend>Personal Information</legend>
            <div>
                <label for="first_name">First Name:</label>
                <input type="text" id="first_name" name="first_name" value="">
            </div>
            <div>
                <label for="last_name">Last Name:</label>
                <input type="text" id="last_name" name="last_name" value="">
            </div>
            <div>
                <label for="MINC">MINC:</label>
                <input type="text" id="MINC" name="MINC" value="">
            </div>
            <div>
                <label for="phone_number">Phone Number:</label>
                <input type="text" id="phone_number" name="phone_number" value="">
            </div>
        </fieldset>
        <fieldset>
            <legend>Contact Information</legend>
            <div>
                <label for="address">Address:</label>
                <input type="text" id="address" name="address" value="">
            </div>
            <div>
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" value="">
            </div>
            <div>
                <label for="dob">Date of Birth:</label>
                <input type="date" id="dob" name="dob" value="">
            </div>
        </fieldset>
        <fieldset>
            <legend>Professional Information</legend>
            <div>
                <label for="education">Education:</label>
                <textarea id="education" name="education"></textarea>
            </div>
            <div>
                <label for="specialization">Specialization:</label>
                <input type="text" id="specialization" name="specialization" value="">
            </div>
            <div>
                <label for="clinicAffiliation">Clinic Affiliation:</label>
                <input type="text" id="clinicAffiliation" name="clinicAffiliation" value="">
            </div>
            <div>
                <label for="experience">Experience (years):</label>
                <input type="number" id="experience" name="experience" value="">
            </div>
            <div>
                <label for="certifications">Certifications:</label>
                <textarea id="certifications" name="certifications"></textarea>
            </div>
            <div>
                <label for="professionalMembership">Professional Membership:</label>
                <input type="text" id="professionalMembership" name="professionalMembership" value="">
            </div>
        </fieldset>
        <input type="hidden" id="user_id" name="user_id" value="<?php echo $_SESSION['user_id']; ?>">
        <button type="button" id="updateProfileBtn">Update Profile</button>
    </form>
</div>


<footer>
    <p>&copy; 2024 MediPath. All rights reserved.</p>
</footer>

<script>
    $(document).ready(function() {
        $('#updateProfileBtn').click(function(event) {
            event.preventDefault();
            var updatedProfileData = {
                first_name: $('#first_name').val(),
                last_name: $('#last_name').val(),
                MINC: $('#MINC').val(),
                phone_number: $('#phone_number').val(),
                address: $('#address').val(),
                email: $('#email').val(),
                dob: $('#dob').val(),
                education: $('#education').val(),
                specialization: $('#specialization').val(),
                clinicAffiliation: $('#clinicAffiliation').val(),
                experience: $('#experience').val(),
                certifications: $('#certifications').val(),
                professionalMembership: $('#professionalMembership').val(),
                image_url: $('#image_url').val()
            };

            $.ajax({
                url: 'updateProvider.php',
                method: 'POST',
                data: JSON.stringify(updatedProfileData),
                contentType: 'application/json',
                success: function(response) {
                    if (response.success) {
                        fetchAndDisplayProvider();
                        alert('Profile updated successfully!');
                    } else {
                        alert('Failed to update profile: ' + response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('AJAX Error:', error);
                    alert('Failed to update profile. Please try again later.');
                }
            });
        });

        fetchAndDisplayProvider();
    });

    function fetchAndDisplayProvider() {
        $.ajax({
            url: 'Pprofile.php',
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                if (response.hasOwnProperty('provider')) {
                    const provider = response.provider;
                    $('#first_name').val(provider.first_name);
                    $('#last_name').val(provider.last_name);
                    $('#MINC').val(provider.MINC);
                    $('#phone_number').val(provider.phone_number);
                    $('#address').val(provider.address);
                    $('#email').val(provider.email);
                    $('#dob').val(provider.dob);
                    $('#education').val(provider.education);
                    $('#specialization').val(provider.specialization);
                    $('#clinicAffiliation').val(provider.clinicAffiliation);
                    $('#experience').val(provider.experience);
                    $('#certifications').val(provider.certifications);
                    $('#professionalMembership').val(provider.professionalMembership);
                } else {
                    console.error('Invalid data format:', response);
                }
            },
            error: function(xhr, status, error) {
                console.error('Failed to fetch provider:', error);
            }
        });
    }

</script>

</body>
</html>
